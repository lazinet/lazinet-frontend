
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital Business Card - Professional</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;900&display=swap" rel="stylesheet">
    <!-- html2canvas & jsPDF for export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body { font-family: 'Inter', sans-serif; overflow-x: hidden; }
        .bizcard-box { aspect-ratio: 90 / 54; position: relative; overflow: hidden; border-radius: 12px; box-shadow: 0 20px 40px -10px rgba(0,0,0,0.4); transition: transform 0.3s ease; background-size: cover; background-position: center; }
        .bizcard-box:hover { transform: translateY(-5px); }
        .glass-panel { background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(15px); border: 1px solid rgba(255,255,255,0.3); }
        .bg-video { position: fixed; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; z-index: -1; opacity: 0.5; }
        .chat-user { background-color: #1d4ed8; color: white; border-bottom-right-radius: 0; }
        .chat-bot { background-color: #f3f4f6; color: #1f2937; border-bottom-left-radius: 0; }
        .loading-spin { border: 3px solid #f3f3f3; border-top: 3px solid #187752; border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @media (max-width: 768px) { .bizcard-box { width: 100% !important; max-width: 100% !important; } }
    </style>

</head>
<body class="bg-gray-50 min-h-screen">

    <!-- Background Components -->
    <div id="overlay" class="fixed inset-0 z-[-2]"></div>
    <video id="vBg" class="bg-video" autoplay loop muted playsinline></video>

    <!-- Main Content -->
    <div id="app" class="hidden opacity-0 transition-opacity duration-1000">
        <div class="max-w-7xl mx-auto px-4 py-6 md:py-12 flex flex-col items-center">
            
            <!-- Intro Header -->
            <div class="w-full flex flex-col md:flex-row justify-between items-center mb-8 glass-panel p-6 rounded-3xl shadow-2xl">
                <div class="text-center md:text-left">
                    <h1 id="uiName" class="text-3xl font-black uppercase tracking-tighter"></h1>
                    <p id="uiPos" class="text-lg font-semibold opacity-70"></p>
                </div>
                <div class="mt-4 md:mt-0">
                    <select class="bg-white border border-gray-200 px-4 py-2 rounded-full font-bold text-xs outline-none cursor-pointer">
                        <option>VI·ªÜT NAM (VI)</option>
                        <option disabled>ENGLISH (EN)</option>
                    </select>
                </div>
            </div>

            <!-- Business Card Area -->
            <div id="bizcardArea" class="w-full flex flex-col lg:flex-row justify-center gap-8 md:gap-12 mb-12">
                <!-- Front Side -->
                <div id="card1" class="bizcard-box w-full max-w-[550px] text-white">
                    <div class="absolute inset-0 bg-black/30"></div>
                    <div class="relative z-10 h-full p-8 flex flex-col justify-between">
                        <div class="flex justify-between items-start">
                            <img id="logo1" src="" class="h-12 w-auto object-contain bg-white/10 p-2 rounded backdrop-blur">
                            <div class="flex gap-2">
                                <span class="w-6 h-6 bg-blue-600 rounded flex items-center justify-center text-[10px] font-bold">Z</span>
                                <span class="w-6 h-6 bg-green-500 rounded flex items-center justify-center text-[10px] font-bold">W</span>
                            </div>
                        </div>
                        <div>
                            <h2 id="cName" class="text-3xl font-black mb-1"></h2>
                            <p id="cPos" class="text-sm font-semibold border-l-4 border-yellow-400 pl-3 uppercase tracking-wider opacity-90"></p>
                        </div>
                        <div class="grid grid-cols-2 gap-4 text-[10px] font-medium">
                            <div class="space-y-1">
                                <p id="cPhone"></p>
                                <p id="cEmail"></p>
                            </div>
                            <div class="text-right space-y-1">
                                <p id="cWeb"></p>
                                <p id="cAddr"></p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Back Side -->
                <div id="card2" class="bizcard-box w-full max-w-[550px]">
                    <div class="absolute inset-0 bg-white/95"></div>
                    <div class="relative z-10 h-full p-8 flex flex-col justify-between" id="textAccent">
                        <div class="flex justify-between items-start">
                            <img id="logo2" src="" class="h-12 w-auto object-contain">
                            <div class="bg-white p-1 rounded-lg shadow-xl border border-gray-100">
                                <img id="qr" src="" class="w-20 h-20">
                            </div>
                        </div>
                        <div class="flex-grow my-4 grid grid-cols-2 gap-x-6 py-4 border-y border-gray-200/50">
                            <ul class="text-[11px] space-y-2 font-bold opacity-80" id="busL"></ul>
                            <ul class="text-[11px] space-y-2 font-bold opacity-80" id="busR"></ul>
                        </div>
                        <div class="text-[10px] leading-tight font-medium">
                            <p id="cComp" class="font-black uppercase mb-1"></p>
                            <p id="cAddr1" class="opacity-70"></p>
                            <p id="cAddr2" class="opacity-70"></p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Footer Buttons -->
            <div class="grid grid-cols-2 sm:grid-cols-5 gap-4 w-full max-w-4xl no-export">
                <button onclick="toggleModal('leadModal', true)" class="flex flex-col items-center gap-3 p-5 glass-panel rounded-3xl hover:bg-white transition shadow-lg group">
                    <div class="w-12 h-12 bg-blue-600 text-white rounded-full flex items-center justify-center text-xl shadow-lg shadow-blue-200">üí¨</div>
                    <span class="text-[10px] font-black uppercase text-gray-600">Chat</span>
                </button>
                <button onclick="share()" class="flex flex-col items-center gap-3 p-5 glass-panel rounded-3xl hover:bg-white transition shadow-lg group">
                    <div class="w-12 h-12 bg-red-600 text-white rounded-full flex items-center justify-center text-xl shadow-lg shadow-red-200">üîó</div>
                    <span class="text-[10px] font-black uppercase text-gray-600">Share</span>
                </button>
                <button onclick="exportImage()" class="flex flex-col items-center gap-3 p-5 glass-panel rounded-3xl hover:bg-white transition shadow-lg group">
                    <div class="w-12 h-12 bg-green-600 text-white rounded-full flex items-center justify-center text-xl shadow-lg shadow-green-200">üñºÔ∏è</div>
                    <span class="text-[10px] font-black uppercase text-gray-600">PNG</span>
                </button>
                <button onclick="exportVCard()" class="flex flex-col items-center gap-3 p-5 glass-panel rounded-3xl hover:bg-white transition shadow-lg group">
                    <div class="w-12 h-12 bg-emerald-700 text-white rounded-full flex items-center justify-center text-xl shadow-lg shadow-emerald-200">üë§</div>
                    <span class="text-[10px] font-black uppercase text-gray-600">vCard</span>
                </button>
                <button onclick="exportPDF()" class="flex flex-col items-center gap-3 p-5 glass-panel rounded-3xl hover:bg-white transition shadow-lg group">
                    <div class="w-12 h-12 bg-gray-800 text-white rounded-full flex items-center justify-center text-xl shadow-lg shadow-gray-200">üìÑ</div>
                    <span class="text-[10px] font-black uppercase text-gray-600">PDF</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div id="leadModal" class="fixed inset-0 z-50 hidden flex items-center justify-center bg-black/60 backdrop-blur-sm p-4">
        <div class="bg-white w-full max-w-md rounded-[2.5rem] shadow-2xl overflow-hidden animate-bounce-in">
            <div class="p-8 relative">
                <button onclick="toggleModal('leadModal', false)" class="absolute top-6 right-6 text-gray-400 hover:text-gray-900 transition">‚úï</button>
                
                <div class="flex items-center gap-4 mb-8">
                    <div class="relative">
                        <img id="mAvatar" src="" class="w-16 h-16 rounded-full object-cover ring-4 ring-green-50">
                        <div class="absolute bottom-0 right-0 w-4 h-4 bg-green-500 border-2 border-white rounded-full"></div>
                    </div>
                    <div>
                        <h3 id="mName" class="font-black text-gray-900 text-lg"></h3>
                        <p id="mPos" class="text-[10px] text-gray-500 uppercase font-black tracking-widest"></p>
                        <div class="flex items-center gap-2 mt-1">
                            <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
                            <span class="text-[10px] text-green-600 font-black uppercase">ƒêang s·∫µn s√†ng</span>
                        </div>
                    </div>
                </div>

                <form id="leadForm" class="space-y-4">
                    <div class="grid grid-cols-2 gap-4">
                        <input type="text" name="name" placeholder="H·ªç v√† t√™n *" required class="w-full px-5 py-4 bg-gray-50 rounded-2xl border-none focus:ring-2 focus:ring-blue-600 text-sm font-semibold transition-all">
                        <input type="text" name="phone" placeholder="S·ªë ƒëi·ªán tho·∫°i *" required class="w-full px-5 py-4 bg-gray-50 rounded-2xl border-none focus:ring-2 focus:ring-blue-600 text-sm font-semibold transition-all">
                    </div>
                    <input type="text" name="company" placeholder="C√¥ng ty" class="w-full px-5 py-4 bg-gray-50 rounded-2xl border-none focus:ring-2 focus:ring-blue-600 text-sm font-semibold transition-all">
                    <input type="email" name="email" placeholder="ƒê·ªãa ch·ªâ Email" class="w-full px-5 py-4 bg-gray-50 rounded-2xl border-none focus:ring-2 focus:ring-blue-600 text-sm font-semibold transition-all">
                    <textarea name="message" placeholder="N·ªôi dung c·∫ßn t∆∞ v·∫•n..." class="w-full px-5 py-4 bg-gray-50 rounded-2xl border-none focus:ring-2 focus:ring-blue-600 text-sm font-semibold transition-all h-28 resize-none"></textarea>
                    
                    <label class="flex items-center gap-3 p-4 bg-blue-50 rounded-2xl cursor-pointer hover:bg-blue-100 transition-all">
                        <input type="checkbox" name="consult" checked class="w-5 h-5 accent-blue-600">
                        <span class="text-xs font-black text-blue-900 uppercase">T∆∞ v·∫•n tr·ª±c ti·∫øp v·ªõi Th∆∞ k√Ω</span>
                    </label>

                    <button type="submit" class="w-full py-5 bg-blue-600 text-white rounded-2xl font-black shadow-xl shadow-blue-100 hover:shadow-blue-200 transition-all active:scale-95 uppercase tracking-widest">G·ª≠i Th√¥ng Tin</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Chat Box -->
    <div id="chatBox" class="fixed bottom-6 right-6 left-6 md:left-auto md:w-[420px] z-[60] hidden flex flex-col bg-white rounded-[2rem] shadow-2xl border border-gray-100 overflow-hidden h-[600px] animate-slide-up">
        <div class="p-5 bg-blue-700 flex justify-between items-center text-white">
            <div class="flex items-center gap-3">
                <img id="cAvatar" src="" class="w-10 h-10 rounded-full border-2 border-white/40">
                <span id="cBotName" class="font-bold text-sm tracking-tight"></span>
            </div>
            <button onclick="toggleModal('chatBox', false)" class="p-2 hover:bg-white/10 rounded-full">‚úï</button>
        </div>
        <div id="msgList" class="flex-grow overflow-y-auto p-5 space-y-4 bg-gray-50/50"></div>
        <div id="typing" class="hidden px-5 py-2 text-[10px] font-bold text-gray-400 italic">Nh√¢n vi√™n ƒëang so·∫°n c√¢u tr·∫£ l·ªùi...</div>
        <div class="p-4 bg-white border-t flex gap-2 items-center">
            <input id="chatInp" type="text" placeholder="Nh·∫≠p tin nh·∫Øn..." class="flex-grow px-5 py-3 bg-gray-100 rounded-full outline-none focus:ring-2 focus:ring-blue-600 text-sm font-semibold">
            <button onclick="sendMsg()" class="p-4 bg-blue-600 text-white rounded-full hover:bg-blue-700 transition shadow-lg">‚û§</button>
        </div>
    </div>

    <!-- Initial Loading -->
    <div id="loading" class="fixed inset-0 z-[100] flex flex-col items-center justify-center bg-white">
        <div class="loading-spin mb-4"></div>
        <p class="text-[10px] font-black text-gray-400 uppercase tracking-[0.2em] animate-pulse">NECS Digital Bizcard</p>
    </div>

    <script>
        // C·∫§U H√åNH QUAN TR·ªåNG: Thay URL Web App c·ªßa b·∫°n v√†o ƒë√¢y
        const GAS_URL = 'https://script.google.com/macros/s/AKfycbyX3kg9XSGffcvWEvd4ML1nmrisoZQ5R-ceM3HXfulRE699xjNH-2YsVwBme2ezipXVtw/exec'; 

        let bizData = null;
        let appConfig = null;
        let chatHist = [];

        // Kh·ªüi t·∫°o ·ª©ng d·ª•ng
        window.addEventListener('load', async () => {
            if (GAS_URL.includes('PASTE_YOUR')) {
                alert("Vui l√≤ng d√°n URL Web App c·ªßa Google Apps Script v√†o file HTML.");
                return;
            }
            try {
                const r = await fetch(`${GAS_URL}?type=init`);
                const d = await r.json();
                bizData = d.bizcard;
                appConfig = d.config;
                setupUI();
            } catch (err) {
                console.error(err);
                alert("K·∫øt n·ªëi th·∫•t b·∫°i. Vui l√≤ng ki·ªÉm tra quy·ªÅn truy c·∫≠p Web App.");
            }
        });

        function setupUI() {
            const b = bizData;
            document.title = b.htmlTitle;
            document.getElementById('overlay').style.backgroundColor = b.backgroundColor;
            document.getElementById('vBg').src = b.backgroundVideo;
            
            // Header
            document.getElementById('uiName').innerText = b.bizcardPersonName;
            document.getElementById('uiName').style.color = b.primaryColor;
            document.getElementById('uiPos').innerText = b.bizcardPersonPosition;

            // Card 1
            document.getElementById('card1').style.backgroundImage = `url(${b.bizcardBackgroundImage1})`;
            document.getElementById('logo1').src = b.bizcardLogoURL;
            document.getElementById('cName').innerText = b.bizcardPersonName;
            document.getElementById('cPos').innerText = b.bizcardPersonPosition;
            document.getElementById('cPhone').innerText = "Phone: " + b.bizcardPersonMobile;
            document.getElementById('cEmail').innerText = "Email: " + b.bizcardPersonEmail;
            document.getElementById('cWeb').innerText = b.bizcardPompanyWebsite.replace('https://','');
            document.getElementById('cAddr').innerText = b.bizcardCompanyAddress;

            // Card 2
            document.getElementById('card2').style.backgroundImage = `url(${b.bizcardBackgroundImage2})`;
            document.getElementById('logo2').src = b.bizcardLogoURL;
            document.getElementById('qr').src = `https://api.qrserver.com/v1/create-qr-code/?size=180x180&data=${encodeURIComponent(b.bizcardQRText)}`;
            document.getElementById('textAccent').style.color = b.primaryColor;
            document.getElementById('cComp').innerText = b.bizcardCompanyName;
            document.getElementById('cAddr1').innerText = "VP: " + b.bizcardCompanyAddress;
            document.getElementById('cAddr2').innerText = "Kho: " + b.bizcardCompanyAddress2;
            
            const l = [b.bizcardBusiness1, b.bizcardBusiness2, b.bizcardBusiness3];
            const r = [b.bizcardBusiness4, b.bizcardBusiness5, b.bizcardBusiness6];
            document.getElementById('busL').innerHTML = l.map(t => `<li>‚úì ${t}</li>`).join('');
            document.getElementById('busR').innerHTML = r.map(t => `<li>‚úì ${t}</li>`).join('');

            // Modals & Bot
            document.getElementById('mAvatar').src = b.chatbotAvatar;
            document.getElementById('cAvatar').src = b.chatbotAvatar;
            document.getElementById('mName').innerText = b.chatbotName;
            document.getElementById('cBotName').innerText = b.chatbotName;
            document.getElementById('mPos').innerText = b.chatbotPosition;

            // Reveal App
            document.getElementById('loading').classList.add('hidden');
            const app = document.getElementById('app');
            app.classList.remove('hidden');
            setTimeout(() => app.classList.replace('opacity-0', 'opacity-100'), 100);
        }

        // Modal Helpers
        function toggleModal(id, show) { 
            const m = document.getElementById(id);
            m.classList.toggle('hidden', !show);
            if(show) m.classList.add('flex');
            else m.classList.remove('flex');
        }

        // Form Submission
        document.getElementById('leadForm').onsubmit = async (e) => {
            e.preventDefault();
            const fd = new FormData(e.target);
            const data = {
                name: fd.get('name'),
                phone: fd.get('phone'),
                company: fd.get('company'),
                email: fd.get('email'),
                message: fd.get('message'),
                wantsConsulting: fd.get('consult') === 'on'
            };

            document.getElementById('loading').classList.remove('hidden');
            
            try {
                await fetch(GAS_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    body: JSON.stringify({ type: 'lead', data })
                });

                toggleModal('leadModal', false);
                if (data.wantsConsulting && appConfig.chatbotValidity) {
                    startChat(data.name, data.message);
                } else {
                    alert("C·∫£m ∆°n b·∫°n! Ch√∫ng t√¥i ƒë√£ nh·∫≠n ƒë∆∞·ª£c th√¥ng tin.");
                }
            } catch (err) {
                alert("L·ªói k·∫øt n·ªëi. Vui l√≤ng th·ª≠ l·∫°i.");
            } finally {
                document.getElementById('loading').classList.add('hidden');
            }
        };

        // AI Chatbot Logic
        function startChat(userName, userMsg) {
            toggleModal('chatBox', true);
            const firstMsg = `D·∫° ch√†o anh/ch·ªã ${userName}! Em l√† ${bizData.chatbotName}, th∆∞ k√Ω c·ªßa anh L√™ Minh Ph·ª•ng. Em ƒë√£ nh·∫≠n ƒë∆∞·ª£c y√™u c·∫ßu v·ªÅ "${userMsg || 'Logistics'}". Em r·∫•t s·∫µn l√≤ng h·ªó tr·ª£ anh/ch·ªã ngay b√¢y gi·ªù ·∫°!`;
            addMsg('assistant', firstMsg);
        }

        async function sendMsg() {
            const inp = document.getElementById('chatInp');
            const txt = inp.value.trim();
            if (!txt) return;

            addMsg('user', txt);
            inp.value = '';
            document.getElementById('typing').classList.remove('hidden');

            try {
                const res = await fetch(GAS_URL, {
                    method: 'POST',
                    body: JSON.stringify({ type: 'chat', prompt: txt, history: chatHist })
                });
                const d = await res.json();
                addMsg('assistant', d.text);
            } catch (err) {
                addMsg('assistant', "Em xin l·ªói, ƒë∆∞·ªùng truy·ªÅn AI ƒëang gi√°n ƒëo·∫°n. Anh/ch·ªã vui l√≤ng th·ª≠ l·∫°i sau.");
            } finally {
                document.getElementById('typing').classList.add('hidden');
            }
        }

        function addMsg(role, content) {
            const list = document.getElementById('msgList');
            const div = document.createElement('div');
            div.className = `flex ${role === 'user' ? 'justify-end' : 'justify-start'}`;
            div.innerHTML = `
                <div class="max-w-[85%] p-4 rounded-2xl text-sm font-semibold shadow-sm ${role === 'user' ? 'chat-user' : 'chat-bot'}">
                    ${content}
                </div>
            `;
            list.appendChild(div);
            list.scrollTop = list.scrollHeight;
            chatHist.push({ role, content });
        }

        // Export & Utility
        async function exportImage() {
            const area = document.getElementById('bizcardArea');
            const canvas = await html2canvas(area, { scale: 3, useCORS: true, backgroundColor: null });
            const l = document.createElement('a');
            l.download = `${bizData.bizcardPersonName}.png`;
            l.href = canvas.toDataURL('image/png');
            l.click();
        }

        async function exportPDF() {
            const area = document.getElementById('bizcardArea');
            const canvas = await html2canvas(area, { scale: 2, useCORS: true });
            const imgData = canvas.toDataURL('image/png');
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('l', 'mm', 'a4');
            doc.addImage(imgData, 'PNG', 10, 10, 277, 160);
            doc.save(`${bizData.bizcardPersonName}.pdf`);
        }

        function exportVCard() {
            const b = bizData;
            const v = `BEGIN:VCARD\nVERSION:3.0\nFN:${b.bizcardPersonName}\nORG:${b.bizcardCompanyName}\nTITLE:${b.bizcardPersonPosition}\nTEL;TYPE=CELL:${b.bizcardPersonMobile}\nEMAIL:${b.bizcardPersonEmail}\nURL:${b.bizcardPompanyWebsite}\nADR;TYPE=WORK:;;${b.bizcardCompanyAddress}\nEND:VCARD`;
            const blob = new Blob([v], { type: 'text/vcard' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `${b.bizcardPersonName}.vcf`;
            link.click();
        }

        function share() {
            if (navigator.share) navigator.share({ title: document.title, url: location.href });
            else { navigator.clipboard.writeText(location.href); alert("ƒê√£ copy link chia s·∫ª!"); }
        }
    </script>
</body>
</html>
