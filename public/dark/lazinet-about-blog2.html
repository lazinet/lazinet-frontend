<!DOCTYPE html>
<html lang="zxx">
<head>
    <!-- Meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <meta name="description" content="">
    <meta name="keywords" content="">
    <meta name="author" content="Awaiken">
    <!-- Page Title (dynamic) -->
    <title id="dynamic-title">Netzon - Cyber Security Services HTML Template</title>
    <!-- Favicon Icon -->
    <link rel="shortcut icon" type="image/x-icon" href="assets/images/favicon.png">
    <!-- Google Fonts Css-->
    <link rel="preconnect" href="https://fonts.googleapis.com/">
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Sora:wght@100..800&amp;display=swap" rel="stylesheet">
    <!-- Bootstrap Css -->
    <link href="assets/css/bootstrap.min.css" rel="stylesheet" media="screen">
    <!-- SlickNav Css -->
    <link href="assets/css/slicknav.min.css" rel="stylesheet">
    <!-- Swiper Css -->
    <link rel="stylesheet" href="assets/css/swiper-bundle.min.css">
    <!-- Font Awesome Icon Css-->
    <link href="assets/css/all.min.css" rel="stylesheet" media="screen">
    <!-- Animated Css -->
    <link href="assets/css/animate.css" rel="stylesheet">
    <!-- Magnific Popup Core Css File -->
    <link rel="stylesheet" href="assets/css/magnific-popup.css">
    <!-- Mouse Cursor Css File -->
    <link rel="stylesheet" href="assets/css/mousecursor.css">
    <!-- Main Custom Css -->
    <link href="assets/css/custom.css" rel="stylesheet" media="screen">
    <style>
        /* Custom Tooltip for Image Overlay (list mode) */
        .post-featured-image {
            position: relative;
            overflow: hidden;
        }
        .post-featured-image .image-tooltip {
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            bottom: 20px;
            background-color: rgba(0, 0, 0, 0.7);
            color: #ffffff;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 15px;
            border-radius: 8px;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
            font-size: 14px;
            line-height: 1.4;
            z-index: 10;
            backdrop-filter: blur(5px);
            overflow-y: auto;
            max-height: 80%;
        }
        .post-featured-image .image-tooltip .tooltip-header {
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 16px;
            text-align: center;
        }
        .post-featured-image .image-tooltip .tooltip-body {
            text-align: justify;
            hyphens: auto;
        }
        .post-featured-image:hover .image-tooltip {
            opacity: 1;
            visibility: visible;
        }
        .post-featured-image figure {
            position: relative;
        }
        .post-featured-image img {
            transition: transform 0.3s ease;
        }
        .post-featured-image:hover img {
            transform: scale(1.05);
        }
        /* Single post styles */
        .post-byline {
            font-weight: bold;
            font-style: italic;
            margin-bottom: 20px;
            color: #333;
        }
        #post-image img {
            min-height: 300px;
            background-color: #f0f0f0;
        }
        .page-single-post {
            display: none; /* Ẩn ban đầu */
        }
        .page-blog .page-pagination {
            display: none; /* Ẩn pagination khi single */
        }
        /* Transition giữa list và single */
        .page-transition {
            transition: opacity 0.3s ease;
        }
        /* Force visible for single post image (override GSAP initial state) */
        #single-container .reveal {
            visibility: visible !important;
            opacity: 1 !important;
            transform: none !important;
        }
        #single-container .reveal img {
            transform: none !important;
            opacity: 1 !important;
        }
        /* New: Swiper Slider Styles for Single Post */
        #post-image .image-slider {
            position: relative;
            width: 100%;
            height: auto;
            min-height: 300px;
        }
        #post-image .swiper-slide {
            display: flex;
            justify-content: center;
            align-items: center;
        }
        #post-image .swiper-slide figure {
            margin: 0;
            width: 100%;
            height: auto;
        }
        #post-image .swiper-slide img {
            width: 100%;
            height: auto;
            object-fit: cover;
        }
        #post-image .swiper-button-next,
        #post-image .swiper-button-prev {
            color: #fff;
            background: rgba(0, 0, 0, 0.5);
            width: 40px;
            height: 40px;
            border-radius: 50%;
        }
        #post-image .swiper-button-next:after,
        #post-image .swiper-button-prev:after {
            font-size: 16px;
        }
        #post-image .post-pagination {
            bottom: 10px;
        }
        #post-image .swiper-pagination-bullet {
            background: #fff;
            opacity: 0.5;
        }
        #post-image .swiper-pagination-bullet-active {
            opacity: 1;
        }
        /* Pagination styles */
        .page-pagination ul {
            justify-content: center;
        }
        .page-pagination li a {
            text-decoration: none;
            padding: 8px 12px;
            border: 1px solid #ddd;
            margin: 0 2px;
            border-radius: 4px;
        }
        .page-pagination li.active a {
            background-color: #007bff;
            color: white;
            border-color: #007bff;
        }
        .page-pagination li.disabled a {
            pointer-events: none;
            opacity: 0.5;
            cursor: not-allowed;
        }
        .page-pagination li:not(.active):not(.disabled) a:hover {
            background-color: #f8f9fa;
        }
    </style>
</head>
<body>

    <!-- Preloader Start -->
    <div class="preloader">
        <div class="loading-container">
            <div class="loading"></div>
            <div id="loading-icon"><img src="assets/img/logo-lazinet/lazinet_LogoOnly.svg" alt=""></div>
        </div>
    </div>
    <!-- Preloader End -->

    <!-- Page Blog Start (List Mode) -->
    <div class="page-blog page-transition" id="list-container">
        <div class="container">
            <div class="row" id="blog-list">
                <!-- Dynamic posts will be rendered here -->
            </div>
            <div class="col-lg-12">
                <!-- Page Pagination Start -->
                <div class="page-pagination wow fadeInUp" data-wow-delay="1s" id="blog-pagination">
                    <ul class="pagination">
                        <!-- Dynamic pagination will be rendered here: < 1 2 3 > -->
                    </ul>
                </div>
                <!-- Page Pagination End -->
            </div>
        </div>
    </div>
    <!-- Page Blog End -->

    <!-- Page Single Post (Single Mode) -->
    <div class="page-single-post page-transition" id="single-container">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <!-- Post Featured Image Start -->
                    <div class="post-image" id="post-image">
                        <!-- Dynamic image or slider -->
                    </div>
                    <!-- Post Featured Image End -->

                    <!-- Post Single Content Start -->
                    <div class="post-content">
                        <!-- Post Entry Start -->
                        <div class="post-entry" id="post-entry">
                            <!-- Dynamic content -->
                        </div>
                        <!-- Post Entry End -->

                        <!-- Post Tag Links Start -->
                        <div class="post-tag-links">
                            <div class="row align-items-center">
                                <div class="col-lg-8">
                                    <!-- Post Tags Start -->
                                    <div class="post-tags wow fadeInUp" data-wow-delay="0.5s" id="post-tags">
                                        <!-- Dynamic tags -->
                                    </div>
                                    <!-- Post Tags End -->
                                </div>

                                <div class="col-lg-4">
                                    <!-- Post Social Sharing Start -->
                                    <div class="post-social-sharing wow fadeInUp" data-wow-delay="0.5s">
                                        <ul id="social-share">
                                            <li><a href="#" id="share-fb"><i class="fa-brands fa-facebook-f"></i></a></li>
                                            <li><a href="#" id="share-li"><i class="fa-brands fa-linkedin-in"></i></a></li>
                                            <li><a href="#" id="share-ig"><i class="fa-brands fa-instagram"></i></a></li>
                                            <li><a href="#" id="share-tw"><i class="fa-brands fa-x-twitter"></i></a></li>
                                        </ul>
                                    </div>
                                    <!-- Post Social Links End -->
                                </div>
                            </div>
                        </div>
                        <!-- Post Tag Links End -->
                    </div>
                    <!-- Post Single Content End -->
                </div>
            </div>
        </div>
    </div>
    <!-- Page Single Post End -->

    <!-- Back to List Button (for single mode) -->
    <div id="back-to-list" style="display: none; position: fixed; top: 20px; left: 20px; z-index: 1000;">
        <a href="?" class="btn btn-primary">← Back to List</a>
    </div>

    <!-- Jquery Library File -->
    <script src="assets/js/jquery-3.7.1.min.js"></script>
    <script src="assets/js/circle-progress.min.js"></script>
    <script src="assets/js/bootstrap.min.js"></script>
    <script src="assets/js/validator.min.js"></script>
    <script src="assets/js/jquery.slicknav.js"></script>
    <script src="assets/js/swiper-bundle.min.js"></script>
    <script src="assets/js/jquery.waypoints.min.js"></script>
    <script src="assets/js/jquery.counterup.min.js"></script>
    <script src="assets/js/jquery.magnific-popup.min.js"></script>
    <script src="assets/js/SmoothScroll.js"></script>
    <script src="assets/js/parallaxie.js"></script>
    <script src="assets/js/gsap.min.js"></script>
    <script src="assets/js/magiccursor.js"></script>
    <script src="assets/js/SplitText.min.js"></script>
    <script src="assets/js/ScrollTrigger.min.js"></script>
    <script src="assets/js/jquery.mb.YTPlayer.min.js"></script>
    <script src="assets/js/wow.min.js"></script>
    <script src="assets/js/function.js"></script>

<script>
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbymIJb33PnKXC_4SogNgzmd5oCwXjfcHeTPtQMZx_LgxVMjDHlGkyvmEqwporYogponpA/exec';
    const BASE_IMG_URL = 'assets/img/';
    const PLACEHOLDER_IMG = 'assets/images/placeholder.jpg';  // Tạo file nếu cần
    const LIMIT = 6;

    let allBlogs = [];  // Cache full data từ lần load đầu (cho single)

    // Share links (cho single mode)
    function setupShareLinks() {
        const currentUrl = encodeURIComponent(window.location.href);
        const fb = document.getElementById('share-fb');
        const li = document.getElementById('share-li');
        const ig = document.getElementById('share-ig');
        const tw = document.getElementById('share-tw');
        if (fb) fb.href = `https://www.facebook.com/sharer/sharer.php?u=${currentUrl}`;
        if (li) li.href = `https://www.linkedin.com/sharing/share-offsite/?url=${currentUrl}`;
        if (ig) ig.href = `https://www.instagram.com/?url=${currentUrl}`;
        if (tw) tw.href = `https://twitter.com/intent/tweet?url=${currentUrl}&text=Check this out!`;
    }

    // Render single blog (giữ nguyên)
    function renderSingleBlog(blog) {
        const titleEl = document.getElementById('dynamic-title');
        const metaEl = document.getElementById('dynamic-meta');
        if (titleEl) titleEl.textContent = `${blog.Title} - Lazinet`;
        if (metaEl) metaEl.setAttribute('content', blog['P1 (Intro)'] ? blog['P1 (Intro)'].substring(0, 150) + '...' : '');

        // Compute images array if not provided (fallback for cache)
        if (!blog.images) {
            blog.images = [
                blog.Image_Sub_URL,
                blog.Image_Sub_URL_Add1,
                blog.Image_Sub_URL_Add2,
                blog.Image_Sub_URL_Add3,
                blog.Image_Sub_URL_Add4
            ].filter(url => url && url.toString().trim() !== '');
        }
        console.log('Single Blog - Images array:', blog.images);  // Debug images

        const postImageEl = document.getElementById('post-image');
        if (postImageEl && blog.images.length > 0) {
            const firstImgSrc = BASE_IMG_URL + blog.images[0];
            console.log('Single Blog - First img src:', firstImgSrc);

            if (blog.images.length === 1) {
                // Single image (giữ animation reveal)
                postImageEl.innerHTML = `
                    <figure class="image-anime reveal">
                        <img src="${firstImgSrc}" alt="${blog.Title || 'Blog Image'}" loading="lazy" onerror="console.log('Image load error for src:', '${firstImgSrc}'); this.src='${PLACEHOLDER_IMG}'">
                    </figure>
                `;
                // Force GSAP visible
                if (typeof gsap !== 'undefined') {
                    const revealContainer = postImageEl.querySelector('.reveal');
                    if (revealContainer) {
                        gsap.set(revealContainer, { xPercent: 0, autoAlpha: 1 });
                        const image = revealContainer.querySelector('img');
                        if (image) gsap.set(image, { xPercent: 0, scale: 1, autoAlpha: 1 });
                    }
                }
            } else {
                // Multiple images: Swiper slider
                const slidesHtml = blog.images.map(imgSrc => {
                    const fullSrc = BASE_IMG_URL + imgSrc;
                    return `
                        <div class="swiper-slide">
                            <figure class="image-anime reveal">
                                <img src="${fullSrc}" alt="${blog.Title || 'Blog Image'}" loading="lazy" onerror="console.log('Image load error for src:', '${fullSrc}'); this.src='${PLACEHOLDER_IMG}'">
                            </figure>
                        </div>
                    `;
                }).join('');
                postImageEl.innerHTML = `
                    <div class="swiper image-slider" id="post-image-slider">
                        <div class="swiper-wrapper">${slidesHtml}</div>
                        <div class="swiper-button-next post-next"></div>
                        <div class="swiper-button-prev post-prev"></div>
                        <div class="swiper-pagination post-pagination"></div>
                    </div>
                `;
                // Init Swiper
                if (typeof Swiper !== 'undefined') {
                    new Swiper('#post-image-slider', {
                        loop: true,
                        pagination: { el: '.post-pagination', clickable: true },
                        navigation: { nextEl: '.post-next', prevEl: '.post-prev' },
                        autoplay: { delay: 5000, disableOnInteraction: false },
                        speed: 1000,
                        spaceBetween: 0,
                        breakpoints: {
                            768: { slidesPerView: 1 },
                            1366: { slidesPerView: 1 }
                        }
                    });
                }
                // Force GSAP visible for each reveal (after short delay for Swiper init)
                setTimeout(() => {
                    if (typeof gsap !== 'undefined') {
                        postImageEl.querySelectorAll('.reveal').forEach(reveal => {
                            gsap.set(reveal, { xPercent: 0, autoAlpha: 1 });
                            const image = reveal.querySelector('img');
                            if (image) gsap.set(image, { xPercent: 0, scale: 1, autoAlpha: 1 });
                        });
                    }
                }, 200);
            }

            // Refresh ScrollTrigger
            if (typeof ScrollTrigger !== 'undefined') {
                ScrollTrigger.refresh();
            }
        } else {
            // No images fallback
            postImageEl.innerHTML = `<figure><img src="${PLACEHOLDER_IMG}" alt="Placeholder"></figure>`;
        }

        // Content (giữ nguyên)
        let entryHtml = `
            <p class="post-byline wow fadeInUp">By <strong><em>${blog.Author || 'Lazinet Team'}</em></strong> at <a href="${blog.Location_URL || '#'}"><strong><em>${blog.Location || 'N/A'}</em></strong></a> on <strong><em>${new Date(blog.Date).toLocaleDateString('vi-VN')}</em></strong></p>
            <p class="wow fadeInUp">${blog['P1 (Intro)'] || ''}</p>
            <p class="wow fadeInUp" data-wow-delay="0.2s">${blog['P2 (Main)'] || ''}</p>
        `;

        if (blog.Quote) {
            entryHtml += `<blockquote class="wow fadeInUp" data-wow-delay="0.4s"><p>${blog.Quote}</p></blockquote>`;
        }

        entryHtml += `
            <p class="wow fadeInUp" data-wow-delay="0.6s">${blog['P3 (End)'] || ''}</p>
            <h2 class="wow fadeInUp" data-wow-delay="0.8s">${blog.H2 || ''}</h2>
            <p class="wow fadeInUp" data-wow-delay="1s">${blog.P4 || ''}</p>
        `;

        // List items
        let listItems = [];
        for (let i = 1; i <= 6; i++) {
            const liKey = `Li${i}`;
            if (blog[liKey]) listItems.push(`<li>${blog[liKey]}</li>`);
        }
        if (listItems.length > 0) {
            entryHtml += `<ul class="wow fadeInUp" data-wow-delay="1.2s">${listItems.join('')}</ul>`;
        }

        entryHtml += `<p class="wow fadeInUp" data-wow-delay="1.4s">${blog.P5 || ''}</p>`;

        if (blog.External_Name && blog.External_Link) {
            entryHtml += `<p>Source: <a href="${blog.External_Link}" target="_blank">${blog.External_Name}</a></p>`;
        }

        if (blog.Notes) {
            entryHtml += `<p class="wow fadeInUp" data-wow-delay="1.6s"><em>${blog.Notes}</em></p>`;
        }

        const postEntryEl = document.getElementById('post-entry');
        if (postEntryEl) postEntryEl.innerHTML = entryHtml;

        // Tags
        let tagsHtml = '<span class="tag-links">Tags: ';
        let tags = [];
        for (let i = 1; i <= 3; i++) {  // Up to Tag3
            const tagKey = `Tag${i}`;
            if (blog[tagKey]) tags.push(`<a href="#">${blog[tagKey]}</a>`);
        }
        if (tags.length > 0) {
            tagsHtml += tags.join(' ') + '</span>';
            const postTagsEl = document.getElementById('post-tags');
            if (postTagsEl) postTagsEl.innerHTML = tagsHtml;
        } else {
            const postTagsEl = document.getElementById('post-tags');
            if (postTagsEl) postTagsEl.innerHTML = '';
        }

        // Setup share
        setupShareLinks();

        // Re-init WOW
        new WOW().init();
        
        // Refresh GSAP toàn bộ sau WOW
        if (typeof ScrollTrigger !== 'undefined') {
            ScrollTrigger.refresh();
        }
    }

    // Render paginated blog list (with guard clause fix)
    function renderBlogList(blogs, currentPage, totalPages) {
        // Fix: Guard against undefined blogs
        if (!blogs || !Array.isArray(blogs)) {
            console.error('Invalid blogs data:', blogs);
            const row = document.getElementById('blog-list');
            if (row) row.innerHTML = '<p>Error loading posts. Invalid data.</p>';
            return;
        }

        const row = document.getElementById('blog-list');
        if (row) row.innerHTML = '';  // Clear
        blogs.forEach((blog, index) => {
            const delay = (index * 0.2) + 's';
            const dateStr = blog['Date'] ? new Date(blog['Date']).toLocaleDateString('vi-VN') : '';
            const locationStr = blog['Location'] || 'N/A';
            const introFull = blog['P1 (Intro)'] || '';

            const tooltipHtml = `
                <div class="tooltip-header"><strong>${dateStr} - ${locationStr}</strong></div>
                <div class="tooltip-body">${introFull}</div>
            `;

            const imgSubUrlList = blog.Image_Sub_URL || '';
            const imgSrcList = imgSubUrlList ? BASE_IMG_URL + imgSubUrlList : PLACEHOLDER_IMG;
            console.log('List Blog - Raw Image_Sub_URL:', imgSubUrlList);
            console.log('List Blog - Full img src:', imgSrcList);

            const postHtml = `
                <div class="col-xl-4 col-md-6">
                    <div class="post-item wow fadeInUp" data-wow-delay="${delay}">
                        <div class="post-featured-image">
                            <a href="?blog_id=${blog.Blog_ID}" data-cursor-text="View">
                                <figure class="image-anime">
                                    <img src="${imgSrcList}" alt="${blog.Title}">
                                    <div class="image-tooltip">${tooltipHtml}</div>
                                </figure>
                            </a>
                        </div>
                        <div class="post-item-body">
                            <div class="post-item-content">
                                <h2><a href="?blog_id=${blog.Blog_ID}">${blog.Title}</a></h2>
                            </div>
                            <div class="post-item-btn">
                                <a href="?blog_id=${blog.Blog_ID}" class="readmore-btn">read more</a>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            row.insertAdjacentHTML('beforeend', postHtml);
        });
        new WOW().init();

        // Render pagination
        renderPagination(currentPage, totalPages);
    }

    // Render pagination HTML (full < 1 2 3 > with events)
    function renderPagination(currentPage, totalPages) {
        const paginationUl = document.querySelector('#blog-pagination ul');
        if (!paginationUl) return;
        paginationUl.innerHTML = '';

        // Prev button
        const prevLi = document.createElement('li');
        prevLi.className = currentPage === 1 ? 'disabled' : '';
        prevLi.innerHTML = `<a href="?page=${currentPage - 1}"><i class="fa-solid fa-angle-left"></i></a>`;
        if (currentPage > 1) {
            prevLi.addEventListener('click', (e) => {
                e.preventDefault();
                loadPaginatedList(currentPage - 1);
            });
        }
        paginationUl.appendChild(prevLi);

        // Page numbers
        for (let i = 1; i <= totalPages; i++) {
            const li = document.createElement('li');
            li.className = i === currentPage ? 'active' : '';
            li.innerHTML = `<a href="?page=${i}">${i}</a>`;
            li.addEventListener('click', (e) => {
                e.preventDefault();
                loadPaginatedList(i);
            });
            paginationUl.appendChild(li);
        }

        // Next button
        const nextLi = document.createElement('li');
        nextLi.className = currentPage === totalPages ? 'disabled' : '';
        nextLi.innerHTML = `<a href="?page=${currentPage + 1}"><i class="fa-solid fa-angle-right"></i></a>`;
        if (currentPage < totalPages) {
            nextLi.addEventListener('click', (e) => {
                e.preventDefault();
                loadPaginatedList(currentPage + 1);
            });
        }
        paginationUl.appendChild(nextLi);
    }

    // Load paginated list (with fallback for old backend)
    function loadPaginatedList(page = 1) {
        const url = new URL(window.location);
        url.searchParams.set('page', page);
        if (!url.searchParams.has('blog_id')) {
            history.pushState({}, '', url);
        }

        $.ajax({
            url: SCRIPT_URL + `?action=list&page=${page}&limit=${LIMIT}`,
            dataType: 'jsonp',
            success: function(response) {
                console.log('Paginated response:', response);  // Debug
                // Fix: Fallback for old backend (plain array)
                let blogs = response.blogs || response;
                let currentPage = response.current_page || page;
                let totalPages = response.total_pages || (Array.isArray(blogs) ? Math.ceil(blogs.length / LIMIT) : 1);
                renderBlogList(blogs, currentPage, totalPages);
                // Update cache with full list if not loaded (load full once for single)
                if (allBlogs.length === 0) {
                    loadFullBlogsForCache();
                }
            },
            error: function() {
                console.error('Error loading paginated blogs');
                const row = document.getElementById('blog-list');
                if (row) row.innerHTML = '<p>Error loading posts.</p>';
            }
        });
    }

    // Load full blogs for cache (one-time, for single mode) - fallback for old backend
    function loadFullBlogsForCache() {
        $.ajax({
            url: SCRIPT_URL + '?action=list&limit=999',  // Hack: large limit to get all (works with new backend)
            dataType: 'jsonp',
            success: function(response) {
                allBlogs = response.blogs || response;  // Fallback plain array
                console.log('Full cache loaded for single:', allBlogs.length);
            },
            error: function() {
                console.error('Error loading full cache');
            }
        });
    }

    // Load single từ cache hoặc API (giữ nguyên)
    function loadSingleBlog(blogId) {
        // Kiểm tra cache trước (full data từ list)
        const cachedBlog = allBlogs.find(b => b.Blog_ID === blogId);
        if (cachedBlog && cachedBlog['P2 (Main)']) {  // Assume full if has main content
            console.log('Using cached blog for single:', cachedBlog);
            renderSingleBlog(cachedBlog);
        } else {
            // Fetch full from API
            $.ajax({
                url: SCRIPT_URL + '?blog_id=' + blogId,
                dataType: 'jsonp',
                success: function(blog) {
                    console.log('Single blog loaded from API:', blog);
                    if (blog.error) {
                        alert('Blog not found');
                        window.location.href = '?';  // Back to list
                        return;
                    }
                    renderSingleBlog(blog);
                },
                error: function() {
                    console.error('Error loading single blog');
                    alert('Error loading post');
                    window.location.href = '?';
                }
            });
        }
    }

    // Main init
    $(document).ready(function() {
        const urlParams = new URLSearchParams(window.location.search);
        const blogId = urlParams.get('blog_id');
        const page = parseInt(urlParams.get('page')) || 1;

        if (blogId) {
            // Single mode
            const listContainer = document.getElementById('list-container');
            const singleContainer = document.getElementById('single-container');
            const backBtn = document.getElementById('back-to-list');
            if (listContainer) listContainer.style.display = 'none';
            if (singleContainer) singleContainer.style.display = 'block';
            if (backBtn) backBtn.style.display = 'block';
            
            // Delay nhỏ để DOM render, rồi load và refresh
            setTimeout(() => {
                loadSingleBlog(blogId);
                // Refresh GSAP sau khi show container
                if (typeof ScrollTrigger !== 'undefined') {
                    ScrollTrigger.refresh();
                }
                // Additional force refresh after a bit more time
                setTimeout(() => {
                    if (typeof ScrollTrigger !== 'undefined') {
                        ScrollTrigger.refresh();
                    }
                }, 500);
            }, 100);  // 100ms đủ để display block settle
        } else {
            // List mode
            const singleContainer = document.getElementById('single-container');
            const backBtn = document.getElementById('back-to-list');
            if (singleContainer) singleContainer.style.display = 'none';
            if (backBtn) backBtn.style.display = 'none';
            loadPaginatedList(page);
        }
    });
</script>
</body>
</html>