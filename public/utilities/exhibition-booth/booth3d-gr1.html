<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Gian h√†ng LAZINET 3D - Three.js Module Fix (Import Map)</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body { overflow:hidden; font-family:'Segoe UI',Arial,sans-serif; background:#000; }
    #info {
      position: fixed; top:15px; left:15px; color:#fff; background:rgba(0,0,0,0.7);
      padding:12px 18px; border-radius:12px; z-index:100; font-size:1rem;
    }
    #container { width:100vw; height:100vh; }
    .modal {
      display:none; position:fixed; inset:0; background:rgba(0,0,0,0.85); z-index:1000;
      justify-content:center; align-items:center;
    }
    .modal.show { display:flex; }
    .modal-content {
      background:#fff; color:#222; width:90%; max-width:520px; border-radius:16px;
      overflow:hidden; box-shadow:0 20px 60px #000c; transform:scale(0.8); opacity:0;
      transition:all 0.4s ease-out;
    }
    .modal.show .modal-content { transform:scale(1); opacity:1; }
    .modal-header { background:#1e40af; color:white; padding:16px 20px; font-size:1.4rem; font-weight:bold; display:flex; justify-content:space-between; align-items:center; }
    .close { font-size:2.2rem; cursor:pointer; }
    .modal-body { padding:24px; text-align:center; }
    .modal-body img { max-width:100%; max-height:280px; object-fit:contain; border-radius:12px; margin-bottom:20px; }
    .price { font-size:1.8rem; color:#c0392b; font-weight:bold; margin:15px 0; }
    .btn-order { background:#16a34a; color:white; border:none; padding:14px 32px; font-size:1.15rem; border-radius:50px; cursor:pointer; transition:all 0.3s; }
    .btn-order:hover { background:#15803d; transform:translateY(-3px); }
  </style>
</head>
<body>

  <div id="info">üõí Gian h√†ng 3D | K√©o xoay - Cu·ªôn zoom - Click s·∫£n ph·∫©m (Import Map Fix)</div>

  <div id="container"></div>

  <div class="modal" id="modal">
    <div class="modal-content">
      <div class="modal-header">
        <span id="modalTitle">S·∫£n ph·∫©m</span>
        <span class="close" id="close">&times;</span>
      </div>
      <div class="modal-body">
        <img id="modalImg" src="" alt="S·∫£n ph·∫©m">
        <p id="modalDesc"></p>
        <div class="price" id="modalPrice"></div>
        <button class="btn-order" id="orderBtn">ƒê·∫∑t h√†ng ngay</button>
      </div>
    </div>
  </div>

  <!-- Import Map: Map "three" v√† addons ƒë·ªÉ browser hi·ªÉu bare specifier -->
  <script type="importmap">
    {
      "imports": {
        "three": "https://cdn.jsdelivr.net/npm/three@0.168.0/build/three.module.js",
        "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.168.0/examples/jsm/"
      }
    }
  </script>

  <script type="module">
    import * as THREE from 'three';
    import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

    console.log('‚úÖ THREE & OrbitControls imported OK via import map!');

    document.getElementById('info').innerHTML += ' ‚úÖ Loaded!';

    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0x121212);

    const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
    camera.position.set(0, 3, 12);

    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.shadowMap.enabled = true;
    document.getElementById('container').appendChild(renderer.domElement);

    // Lights
    scene.add(new THREE.AmbientLight(0xffffff, 0.7));
    const dirLight = new THREE.DirectionalLight(0xffffff, 1.2);
    dirLight.position.set(10, 15, 10);
    dirLight.castShadow = true;
    scene.add(dirLight);

    const controls = new OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;
    controls.dampingFactor = 0.08;
    controls.minDistance = 4;
    controls.maxDistance = 30;
    controls.target.set(0, 1.5, -5);

    // Floor + Walls + Shelves (gi·ªØ nguy√™n)
    const floor = new THREE.Mesh(
      new THREE.PlaneGeometry(30, 30),
      new THREE.MeshStandardMaterial({ color: 0x4a4a4a, roughness: 0.8 })
    );
    floor.rotation.x = -Math.PI / 2;
    floor.receiveShadow = true;
    scene.add(floor);

    const wallMat = new THREE.MeshStandardMaterial({ color: 0x0000aa, roughness: 0.7 });
    const wallGeo = new THREE.PlaneGeometry(30, 8);
    [{pos: [0,4,-15], rot: 0}, {pos: [-15,4,0], rot: Math.PI/2}, {pos: [15,4,0], rot: -Math.PI/2}].forEach(w => {
      const wall = new THREE.Mesh(wallGeo, wallMat);
      wall.position.set(...w.pos);
      wall.rotation.y = w.rot;
      scene.add(wall);
    });

    function createShelf(x, z) {
      const group = new THREE.Group();
      const mat = new THREE.MeshStandardMaterial({ color: 0x8B4513, roughness: 0.6 });
      const board = new THREE.Mesh(new THREE.BoxGeometry(8, 0.25, 1.2), mat);
      board.position.y = 1.1; board.castShadow = true;
      group.add(board);
      const board2 = board.clone(); board2.position.y = 2.3;
      group.add(board2);
      [-3.7, 3.7].forEach(px => {
        const leg = new THREE.Mesh(new THREE.BoxGeometry(0.25, 2.3, 0.25), mat);
        leg.position.set(px, 1.15, 0); leg.castShadow = true;
        group.add(leg);
      });
      group.position.set(x, 0, z);
      scene.add(group);
    }
    createShelf(-7, -9);
    createShelf(7, -9);

    const products = [];
    const loader = new THREE.TextureLoader();
    function addProduct(img, name, price, desc, x, y, z) {
      loader.load(img, tex => {
        tex.colorSpace = THREE.SRGBColorSpace;
        const mat = new THREE.MeshLambertMaterial({ map: tex });
        const mesh = new THREE.Mesh(new THREE.BoxGeometry(0.9, 1.3, 0.45), mat);
        mesh.position.set(x, y, z - 0.1);
        mesh.castShadow = true;
        mesh.userData = { name, price, desc, img };
        scene.add(mesh);
        products.push(mesh);
      }, undefined, err => console.error('Texture load fail:', err));
    }

    addProduct('https://lazinet.com/assets/img/background/HATHYO_TransBG_002_Original.webp', '√Åo Thun', '289k ‚Ç´', 'Cotton tho√°ng m√°t', -8, 1.4, -9);
    addProduct('https://images.unsplash.com/photo-1620799140408-edc6dcb6d633?w=500', 'Sneaker', '890k ‚Ç´', 'ƒê·∫ø √™m ch√¢n', -6.2, 1.4, -9);
    addProduct('https://images.unsplash.com/photo-1523275335684-37898b6baf30?w=500', 'ƒê·ªìng H·ªì', '1.49tr ‚Ç´', 'Ch·ªëng n∆∞·ªõc', -4.4, 1.4, -9);
    addProduct('https://images.unsplash.com/photo-1505740420928-5e560c06d30e?w=500', 'Tai Nghe', '1.19tr ‚Ç´', 'Ch·ªëng ·ªìn', 4.4, 1.4, -9);
    addProduct('https://images.unsplash.com/photo-1572635196237-14b3f281503f?w=500', 'K√≠nh M√°t', '490k ‚Ç´', 'Ch·ªëng ch√≥i', 6.2, 1.4, -9);
    addProduct('https://images.unsplash.com/photo-1526170375885-4d8ecf77b99f?w=500', 'M√°y ·∫¢nh', '18.9tr ‚Ç´', '4K ch·∫•t l∆∞·ª£ng', 8, 1.4, -9);

    // Raycaster click
    const raycaster = new THREE.Raycaster();
    const mouse = new THREE.Vector2();
    window.addEventListener('click', event => {
      if (event.target.closest('.modal')) return;
      mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
      mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
      raycaster.setFromCamera(mouse, camera);
      const intersects = raycaster.intersectObjects(products);
      if (intersects.length > 0) {
        const data = intersects[0].object.userData;
        document.getElementById('modalTitle').textContent = data.name;
        document.getElementById('modalImg').src = data.img.replace('?w=500', '?w=800');
        document.getElementById('modalDesc').textContent = data.desc;
        document.getElementById('modalPrice').textContent = data.price;
        document.getElementById('modal').classList.add('show');
      }
    });

    document.getElementById('close').onclick = () => document.getElementById('modal').classList.remove('show');
    document.getElementById('orderBtn').onclick = () => {
      alert(`ƒê·∫∑t h√†ng th√†nh c√¥ng: ${document.getElementById('modalTitle').textContent}!`);
      document.getElementById('modal').classList.remove('show');
    };
    document.getElementById('modal').onclick = e => { if (e.target.id === 'modal') document.getElementById('modal').classList.remove('show'); };

    window.addEventListener('resize', () => {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });

    function animate() {
      requestAnimationFrame(animate);
      controls.update();
      renderer.render(scene, camera);
    }
    animate();

    console.log('Booth ready!');
  </script>

</body>
</html>